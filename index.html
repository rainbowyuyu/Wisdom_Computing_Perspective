<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºç®—è§†ç•Œ | Wisdom Computer Perspective</title>

    <!-- æ ¸å¿ƒä¾èµ– -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å›¾æ ‡åº“ -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- æ•°å­¦å…¬å¼æ¸²æŸ“ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <!-- çŸ©é˜µè®¡ç®—åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.0/math.js"></script>
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* å…¨å±€å­—ä½“ */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f4f7fa; overflow-x: hidden; }

        /* åŠ¨ç”»å®šä¹‰ */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }

        .slide-enter-active, .slide-leave-active { transition: all 0.4s ease; }
        .slide-enter-from { transform: translateX(20px); opacity: 0; }
        .slide-leave-to { transform: translateX(-20px); opacity: 0; }

        /* æ–‡å­—æ¸å˜åŠ¨ç”» */
        .animated-gradient-text {
            background: linear-gradient(to right, #4B8BBE, #306998, #4B8BBE);
            background-size: 200% auto;
            -webkit-background-clip: text;
            color: transparent;
            animation: shine 4s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }

        /* ç»ç’ƒæ‹Ÿæ€å¡ç‰‡ */
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.07);
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar-link {
            transition: all 0.3s;
            position: relative;
        }
        .sidebar-link.active::before {
            content: '';
            position: absolute;
            left: 0; top: 0; bottom: 0;
            width: 4px;
            background: #2a8ce5;
            border-radius: 0 4px 4px 0;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* æ¼‚æµ®ç²’å­ (æ¨¡æ‹Ÿ Let it rain) */
        .particle { position: fixed; top: -10vh; z-index: 0; pointer-events: none; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
    </style>
</head>
<body class="text-slate-800">
    <div id="app" class="flex h-screen overflow-hidden">

        <!-- èƒŒæ™¯ç²’å­æ•ˆæœ -->
        <div v-for="n in 20" :key="n" class="particle text-2xl opacity-20"
             :style="{
                 left: Math.random() * 100 + 'vw',
                 animationDuration: (Math.random() * 5 + 5) + 's',
                 animationDelay: -(Math.random() * 5) + 's'
             }">
            âœ¨
        </div>

        <!-- ç§»åŠ¨ç«¯é®ç½© -->
        <div v-if="sidebarOpen && isMobile" @click="toggleSidebar" class="fixed inset-0 bg-black/20 z-20 backdrop-blur-sm lg:hidden"></div>

        <!-- ä¾§è¾¹å¯¼èˆªæ  -->
        <aside :class="['fixed lg:static inset-y-0 left-0 z-30 w-72 bg-white border-r border-slate-200 transform transition-transform duration-300 ease-in-out flex flex-col', sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0']">
            <!-- Logo åŒºåŸŸ -->
            <div class="h-20 flex items-center justify-center border-b border-slate-100 px-6">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-tr from-blue-500 to-cyan-400 rounded-lg flex items-center justify-center text-white font-bold shadow-lg">
                        <i class="fa-solid fa-cube"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-xl text-slate-800 tracking-tight">æ™ºç®—è§†ç•Œ</h1>
                        <p class="text-xs text-slate-400">Smart Calc Vision</p>
                    </div>
                </div>
            </div>

            <!-- å¯¼èˆªèœå• -->
            <nav class="flex-1 overflow-y-auto py-6 px-4 space-y-2">
                <a v-for="item in navItems" :key="item.id"
                   @click="navigate(item.id)"
                   :class="['sidebar-link flex items-center gap-4 px-4 py-3 rounded-xl cursor-pointer hover:bg-blue-50 hover:text-blue-600', currentPage === item.id ? 'bg-blue-50 text-blue-600 font-medium active' : 'text-slate-500']">
                    <i :class="item.icon + ' w-5 text-center'"></i>
                    <span>{{ item.label }}</span>
                </a>
            </nav>

            <!-- ç”¨æˆ·ä¿¡æ¯ / ç™»å½•çŠ¶æ€ -->
            <div class="p-4 border-t border-slate-100">
                <div v-if="user" class="bg-slate-50 p-4 rounded-xl flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold">
                        {{ user.username.charAt(0).toUpperCase() }}
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium truncate">{{ user.username }}</p>
                        <p class="text-xs text-green-500">â— å·²ç™»å½•</p>
                    </div>
                    <button @click="logout" class="text-slate-400 hover:text-red-500 transition">
                        <i class="fa-solid fa-arrow-right-from-bracket"></i>
                    </button>
                </div>
                <div v-else @click="navigate('login')" class="glass-card p-4 rounded-xl text-center cursor-pointer hover:shadow-md transition group">
                    <p class="text-sm text-slate-500 group-hover:text-blue-600">æœªç™»å½•ç”¨æˆ·</p>
                    <p class="text-xs text-blue-500 mt-1">ç‚¹å‡»ç™»å½•ä»¥ä¿å­˜è®°å½•</p>
                </div>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="flex-1 flex flex-col h-full relative overflow-hidden">
            <!-- é¡¶éƒ¨æ  (ç§»åŠ¨ç«¯èœå•å¼€å…³) -->
            <header class="h-16 flex items-center justify-between px-6 lg:hidden bg-white/80 backdrop-blur border-b border-slate-200 z-10">
                <button @click="toggleSidebar" class="text-slate-600">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>
                <span class="font-bold text-slate-700">æ™ºç®—è§†ç•Œ</span>
                <div class="w-6"></div> <!-- å ä½ -->
            </header>

            <!-- é¡µé¢å†…å®¹å®¹å™¨ -->
            <div class="flex-1 overflow-y-auto p-4 lg:p-8 scroll-smooth relative">

                <transition name="slide" mode="out-in">

                    <!-- 1. é¦–é¡µ (Dashboard) -->
                    <div v-if="currentPage === 'home'" key="home" class="max-w-6xl mx-auto space-y-12">
                        <!-- Hero Section -->
                        <div class="text-center py-10 space-y-6">
                            <h1 class="text-4xl lg:text-6xl font-black animated-gradient-text tracking-tight leading-tight">
                                è®©æ•°å­¦è®¡ç®—æ›´åŠ¨æ€<br>æ›´å¯è§†åŒ–
                            </h1>
                            <p class="text-slate-500 text-lg max-w-2xl mx-auto">
                                ç»“åˆè®¡ç®—æœºè§†è§‰ä¸åŠ¨æ€å›¾å½¢æŠ€æœ¯ï¼Œå°†æŠ½è±¡çš„æ•°å­¦å…¬å¼è½¬åŒ–ä¸ºç›´è§‚çš„è§†è§‰ä½“éªŒã€‚
                            </p>

                            <!-- å¿«é€Ÿå…¥å£æŒ‰é’® -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl mx-auto mt-8">
                                <button @click="navigate('detect')" class="group relative px-6 py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-2xl shadow-lg hover:shadow-blue-500/30 hover:-translate-y-1 transition-all duration-300">
                                    <div class="text-2xl mb-2">ğŸ”</div>
                                    <span class="font-medium">ç®—å¼è¯†åˆ«</span>
                                </button>
                                <button @click="navigate('calculate')" class="group relative px-6 py-4 bg-white text-slate-700 border border-slate-200 rounded-2xl shadow-sm hover:shadow-md hover:-translate-y-1 transition-all duration-300">
                                    <div class="text-2xl mb-2">ğŸ§®</div>
                                    <span class="font-medium">åŠ¨æ€è®¡ç®—</span>
                                </button>
                                <button @click="navigate('examples')" class="group relative px-6 py-4 bg-white text-slate-700 border border-slate-200 rounded-2xl shadow-sm hover:shadow-md hover:-translate-y-1 transition-all duration-300">
                                    <div class="text-2xl mb-2">ğŸï¸</div>
                                    <span class="font-medium">æ•™å­¦æ¡ˆä¾‹</span>
                                </button>
                                <button @click="navigate('docs')" class="group relative px-6 py-4 bg-white text-slate-700 border border-slate-200 rounded-2xl shadow-sm hover:shadow-md hover:-translate-y-1 transition-all duration-300">
                                    <div class="text-2xl mb-2">ğŸ“˜</div>
                                    <span class="font-medium">å¸®åŠ©æ–‡æ¡£</span>
                                </button>
                            </div>
                        </div>

                        <!-- è§†é¢‘å±•ç¤ºåŒº -->
                        <div class="glass-card rounded-2xl p-2 md:p-4 shadow-xl">
                            <div class="aspect-video bg-slate-900 rounded-xl overflow-hidden flex items-center justify-center relative group">
                                <!-- æ¨¡æ‹Ÿè§†é¢‘å°é¢ -->
                                <div v-if="!videoPlaying" class="absolute inset-0 bg-gradient-to-tr from-slate-900 to-slate-800 flex flex-col items-center justify-center text-white z-10">
                                    <button @click="videoPlaying = true" class="w-20 h-20 bg-white/20 hover:bg-white/30 backdrop-blur rounded-full flex items-center justify-center transition-all transform hover:scale-110">
                                        <i class="fa-solid fa-play text-3xl ml-2"></i>
                                    </button>
                                    <p class="mt-4 font-light tracking-widest uppercase text-sm">Introduction Video V2</p>
                                </div>
                                <video v-else controls autoplay class="w-full h-full object-cover">
                                    <source src="assert/videos/introduction v2.mp4" type="video/mp4">
                                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                                </video>
                            </div>
                        </div>

                        <!-- ç‰¹æ€§ä»‹ç» -->
                        <div class="grid md:grid-cols-3 gap-6">
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center text-center">
                                <div class="w-14 h-14 bg-blue-50 text-blue-500 rounded-2xl flex items-center justify-center text-2xl mb-4">ğŸ“·</div>
                                <h3 class="font-bold text-lg mb-2">æ™ºèƒ½è¯†åˆ«</h3>
                                <p class="text-slate-500 text-sm">ä¸Šä¼ å›¾ç‰‡æˆ–ç›´æ¥æ‰‹å†™ï¼ŒåŸºäº Qwen-VL æ¨¡å‹ä¸€é”®æå– LaTeX å…¬å¼ã€‚</p>
                            </div>
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center text-center">
                                <div class="w-14 h-14 bg-purple-50 text-purple-500 rounded-2xl flex items-center justify-center text-2xl mb-4">âœï¸</div>
                                <h3 class="font-bold text-lg mb-2">æ‰‹å†™æ¿è¾“å…¥</h3>
                                <p class="text-slate-500 text-sm">å†…ç½® HTML5 Canvas æ‰‹å†™æ¿ï¼Œè‡ªç”±ä¹¦å†™è¡¨è¾¾å¼ï¼Œä½“éªŒå¦‚çº¸ç¬”èˆ¬æµç•…ã€‚</p>
                            </div>
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center text-center">
                                <div class="w-14 h-14 bg-emerald-50 text-emerald-500 rounded-2xl flex items-center justify-center text-2xl mb-4">ğŸ¬</div>
                                <h3 class="font-bold text-lg mb-2">åŠ¨æ€å¯è§†åŒ–</h3>
                                <p class="text-slate-500 text-sm">å°†çŸ©é˜µè¿ç®—ã€å¾®ç§¯åˆ†ç­‰è¿‡ç¨‹åˆ†æ­¥åŠ¨æ€æ¸²æŸ“ï¼Œæ‹’ç»æ¯ç‡¥çš„æ•°å­—å †ç Œã€‚</p>
                            </div>
                        </div>
                    </div>

                    <!-- 2. ç®—å¼è¯†åˆ« (Detect) -->
                    <div v-if="currentPage === 'detect'" key="detect" class="max-w-5xl mx-auto h-full flex flex-col">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-slate-800">ç®—å¼æ£€æµ‹ä¸è¯†åˆ«</h2>
                            <div class="bg-white rounded-lg p-1 border border-slate-200 flex text-sm">
                                <button @click="detectMode = 'upload'" :class="['px-4 py-1.5 rounded transition', detectMode === 'upload' ? 'bg-blue-500 text-white shadow' : 'text-slate-500 hover:text-slate-700']">ä¸Šä¼ å›¾ç‰‡</button>
                                <button @click="detectMode = 'draw'" :class="['px-4 py-1.5 rounded transition', detectMode === 'draw' ? 'bg-blue-500 text-white shadow' : 'text-slate-500 hover:text-slate-700']">æ‰‹å†™ç»˜åˆ¶</button>
                            </div>
                        </div>

                        <div class="grid lg:grid-cols-2 gap-8 flex-1">
                            <!-- è¾“å…¥åŒºåŸŸ -->
                            <div class="glass-card rounded-2xl p-6 flex flex-col h-[500px]">
                                <div v-if="detectMode === 'upload'" class="flex-1 border-2 border-dashed border-slate-300 rounded-xl bg-slate-50 flex flex-col items-center justify-center relative hover:bg-slate-100 transition cursor-pointer overflow-hidden group">
                                    <input type="file" @change="handleFileUpload" class="absolute inset-0 opacity-0 cursor-pointer z-10">
                                    <div v-if="!uploadedImage" class="text-center p-6">
                                        <i class="fa-solid fa-cloud-arrow-up text-4xl text-slate-300 mb-4 group-hover:text-blue-400 transition"></i>
                                        <p class="text-slate-500 font-medium">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</p>
                                        <p class="text-xs text-slate-400 mt-2">æ”¯æŒ JPG, PNG</p>
                                    </div>
                                    <img v-else :src="uploadedImage" class="w-full h-full object-contain p-2" />
                                    <button v-if="uploadedImage" @click.stop="uploadedImage = null" class="absolute top-2 right-2 bg-white rounded-full p-2 shadow hover:text-red-500 z-20"><i class="fa-solid fa-trash"></i></button>
                                </div>

                                <div v-else class="flex-1 bg-white rounded-xl border border-slate-200 relative overflow-hidden flex flex-col">
                                    <!-- ç”»æ¿å·¥å…·æ  -->
                                    <div class="h-10 border-b border-slate-100 flex items-center px-4 gap-4 bg-slate-50">
                                        <button @click="isEraser = false" :class="['text-sm flex items-center gap-1', !isEraser ? 'text-blue-600 font-bold' : 'text-slate-500']"><i class="fa-solid fa-pen"></i> ç”»ç¬”</button>
                                        <button @click="isEraser = true" :class="['text-sm flex items-center gap-1', isEraser ? 'text-blue-600 font-bold' : 'text-slate-500']"><i class="fa-solid fa-eraser"></i> æ©¡çš®</button>
                                        <div class="h-4 w-px bg-slate-300 mx-2"></div>
                                        <button @click="clearCanvas" class="text-xs text-red-500 hover:underline">æ¸…ç©º</button>
                                    </div>
                                    <canvas ref="drawingCanvas" class="flex-1 w-full h-full touch-none cursor-crosshair"></canvas>
                                </div>

                                <div class="mt-4 flex justify-between items-center">
                                    <div class="text-xs text-slate-400" v-if="detectMode === 'upload'">* å»ºè®®ä¸Šä¼ æ¸…æ™°çš„æ•°å­¦å…¬å¼æˆªå›¾</div>
                                    <div class="text-xs text-slate-400" v-else>* æ”¯æŒè§¦æ§ç¬”å’Œé¼ æ ‡ä¹¦å†™</div>
                                    <button @click="processDetection" :disabled="isProcessing" class="px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg shadow-lg hover:shadow-blue-500/30 active:scale-95 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                                        <i v-if="isProcessing" class="fa-solid fa-circle-notch fa-spin"></i>
                                        <span>{{ isProcessing ? 'è¯†åˆ«ä¸­...' : 'å¼€å§‹è¯†åˆ«' }}</span>
                                    </button>
                                </div>
                            </div>

                            <!-- ç»“æœåŒºåŸŸ -->
                            <div class="glass-card rounded-2xl p-6 flex flex-col h-[500px]">
                                <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                                    <i class="fa-brands fa-markdown text-blue-500"></i> è¯†åˆ«ç»“æœ (LaTeX)
                                </h3>
                                <div class="flex-1 bg-white rounded-xl border border-slate-200 p-4 overflow-y-auto mb-4 font-mono text-sm text-slate-600 shadow-inner">
                                    <textarea v-model="latexResult" class="w-full h-full outline-none resize-none text-slate-700" placeholder="ç­‰å¾…è¯†åˆ«ç»“æœ..."></textarea>
                                </div>

                                <h3 class="font-bold text-slate-700 mb-2">é¢„è§ˆæ•ˆæœ</h3>
                                <div ref="latexPreview" class="h-32 bg-slate-50 rounded-xl border border-slate-200 flex items-center justify-center p-4 overflow-x-auto">
                                    <span class="text-slate-400 text-sm italic">æ­¤å¤„å°†æ˜¾ç¤ºå…¬å¼æ¸²æŸ“ç»“æœ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3. åŠ¨æ€è®¡ç®— (Calculate) -->
                    <div v-if="currentPage === 'calculate'" key="calculate" class="max-w-4xl mx-auto">
                        <h2 class="text-2xl font-bold text-slate-800 mb-6">çŸ©é˜µå¯è§†åŒ–è¿ç®—</h2>

                        <div class="grid md:grid-cols-2 gap-6 mb-8">
                            <!-- çŸ©é˜µ A -->
                            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex justify-between items-center mb-3">
                                    <label class="font-bold text-blue-600">çŸ©é˜µ A</label>
                                    <div class="flex gap-2">
                                        <input v-model.number="matrixASize[0]" type="number" min="1" max="5" class="w-10 h-8 border rounded text-center text-sm">
                                        <span class="text-slate-400">x</span>
                                        <input v-model.number="matrixASize[1]" type="number" min="1" max="5" class="w-10 h-8 border rounded text-center text-sm">
                                    </div>
                                </div>
                                <div class="grid gap-2" :style="`grid-template-columns: repeat(${matrixASize[1]}, minmax(0, 1fr))`">
                                    <div v-for="(row, rIndex) in matrixA" :key="rIndex" class="contents">
                                        <input v-for="(val, cIndex) in row" :key="cIndex"
                                            v-model.number="matrixA[rIndex][cIndex]"
                                            class="w-full aspect-square text-center border rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition font-mono"
                                        >
                                    </div>
                                </div>
                            </div>

                            <!-- çŸ©é˜µ B -->
                            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex justify-between items-center mb-3">
                                    <label class="font-bold text-indigo-600">çŸ©é˜µ B</label>
                                    <div class="flex gap-2">
                                        <input v-model.number="matrixBSize[0]" type="number" min="1" max="5" class="w-10 h-8 border rounded text-center text-sm">
                                        <span class="text-slate-400">x</span>
                                        <input v-model.number="matrixBSize[1]" type="number" min="1" max="5" class="w-10 h-8 border rounded text-center text-sm">
                                    </div>
                                </div>
                                <div class="grid gap-2" :style="`grid-template-columns: repeat(${matrixBSize[1]}, minmax(0, 1fr))`">
                                    <div v-for="(row, rIndex) in matrixB" :key="rIndex" class="contents">
                                        <input v-for="(val, cIndex) in row" :key="cIndex"
                                            v-model.number="matrixB[rIndex][cIndex]"
                                            class="w-full aspect-square text-center border rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none transition font-mono"
                                        >
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- æ“ä½œæ  -->
                        <div class="flex justify-center gap-4 mb-8">
                            <button @click="calcMatrix('add')" class="px-6 py-3 bg-white border border-slate-200 rounded-xl shadow-sm hover:border-blue-500 hover:text-blue-500 transition flex items-center gap-2">
                                <i class="fa-solid fa-plus"></i> åŠ æ³•
                            </button>
                            <button @click="calcMatrix('mul')" class="px-6 py-3 bg-white border border-slate-200 rounded-xl shadow-sm hover:border-indigo-500 hover:text-indigo-500 transition flex items-center gap-2">
                                <i class="fa-solid fa-xmark"></i> ä¹˜æ³•
                            </button>
                            <button @click="calcMatrix('det')" class="px-6 py-3 bg-white border border-slate-200 rounded-xl shadow-sm hover:border-emerald-500 hover:text-emerald-500 transition flex items-center gap-2">
                                <i class="fa-solid fa-expand"></i> è¡Œåˆ—å¼(A)
                            </button>
                        </div>

                        <!-- ç»“æœå±•ç¤º (æ¨¡æ‹Ÿè§†é¢‘ + å®æ—¶è®¡ç®—ç»“æœ) -->
                        <div v-if="calcResult" class="glass-card rounded-2xl p-6 animate-fade-in-up">
                            <h3 class="text-lg font-bold mb-4 border-b pb-2">è®¡ç®—è¿‡ç¨‹å¯è§†åŒ–</h3>
                            <div class="grid md:grid-cols-2 gap-8">
                                <div>
                                    <p class="text-xs text-slate-400 mb-2 uppercase tracking-wide">æ•°å€¼ç»“æœ</p>
                                    <div ref="calcMathResult" class="text-xl font-mono bg-slate-50 p-4 rounded-lg border border-slate-200 overflow-x-auto">
                                        <!-- KaTeX rendered result -->
                                    </div>
                                </div>
                                <div>
                                    <p class="text-xs text-slate-400 mb-2 uppercase tracking-wide">åŠ¨æ€æ¼”ç¤º (ç¤ºä¾‹)</p>
                                    <div class="aspect-video bg-black rounded-lg flex items-center justify-center relative overflow-hidden">
                                        <!-- è¿™é‡Œåœ¨å®é™…é¡¹ç›®ä¸­åº”è¿æ¥åç«¯ç”Ÿæˆçš„è§†é¢‘ï¼ŒHTMLæ¼”ç¤ºç‰ˆä½¿ç”¨CSSåŠ¨ç”»æ¨¡æ‹Ÿ -->
                                        <div class="text-white text-center">
                                            <i class="fa-solid fa-film text-3xl mb-2 opacity-50"></i>
                                            <p class="text-xs opacity-70">æ¼”ç¤ºè§†é¢‘ç”Ÿæˆéœ€è¦åç«¯ Python æ”¯æŒ</p>
                                            <p class="text-xs opacity-50 mt-1">HTMLç‰ˆä»…å±•ç¤ºæ•°å€¼è®¡ç®—</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. ç™»å½• (Login) -->
                    <div v-if="currentPage === 'login'" key="login" class="max-w-md mx-auto h-full flex items-center justify-center">
                        <div class="w-full bg-white rounded-2xl shadow-xl p-8 border border-slate-100">
                            <h2 class="text-2xl font-bold text-center mb-1 text-slate-800">{{ loginMode === 'login' ? 'æ¬¢è¿å›æ¥' : 'åˆ›å»ºè´¦æˆ·' }}</h2>
                            <p class="text-center text-slate-400 text-sm mb-8">æ™ºç®—è§†ç•Œ - æ‚¨çš„å¯è§†åŒ–æ•°å­¦åŠ©æ‰‹</p>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">ç”¨æˆ·å</label>
                                    <input v-model="loginForm.username" type="text" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">å¯†ç </label>
                                    <input v-model="loginForm.password" type="password" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">
                                </div>

                                <!-- ç®€å•çš„å›¾å½¢éªŒè¯ç æ¨¡æ‹Ÿ -->
                                <div class="flex gap-4 items-end">
                                    <div class="flex-1">
                                        <label class="block text-sm font-medium text-slate-700 mb-1">éªŒè¯ç </label>
                                        <input v-model="loginForm.captcha" type="text" class="w-full px-4 py-2 border rounded-lg outline-none">
                                    </div>
                                    <div @click="refreshCaptcha" class="h-10 w-24 bg-slate-200 rounded select-none flex items-center justify-center font-mono font-bold text-lg tracking-widest cursor-pointer text-slate-500 italic relative overflow-hidden" title="ç‚¹å‡»åˆ·æ–°">
                                        {{ captchaCode }}
                                        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent w-full h-full" style="transform: skewX(-20deg)"></div>
                                    </div>
                                </div>

                                <button @click="handleAuth" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-2.5 rounded-lg font-medium shadow-lg hover:shadow-blue-500/30 transition transform hover:-translate-y-0.5 mt-4">
                                    {{ loginMode === 'login' ? 'ç™»å½•' : 'æ³¨å†Œ' }}
                                </button>
                            </div>

                            <div class="mt-6 text-center text-sm">
                                <span class="text-slate-400">{{ loginMode === 'login' ? 'è¿˜æ²¡æœ‰è´¦å·?' : 'å·²æœ‰è´¦å·?' }}</span>
                                <button @click="loginMode = loginMode === 'login' ? 'register' : 'login'" class="text-blue-600 font-medium hover:underline ml-1">
                                    {{ loginMode === 'login' ? 'ç«‹å³æ³¨å†Œ' : 'ç›´æ¥ç™»å½•' }}
                                </button>
                            </div>
                        </div>
                    </div>
                     <!-- 5. å¸®åŠ©æ–‡æ¡£ (Docs) & æ¡ˆä¾‹ (Examples) ç•¥ -->
                     <div v-if="currentPage === 'docs' || currentPage === 'examples'" key="others" class="max-w-4xl mx-auto text-center py-20">
                        <div class="text-6xl mb-4">ğŸš§</div>
                        <h2 class="text-2xl font-bold text-slate-700">æ­£åœ¨å»ºè®¾ä¸­</h2>
                        <p class="text-slate-500 mt-2">HTML æ¼”ç¤ºç‰ˆæš‚æœªåŒ…å«å…¨éƒ¨é™æ€å†…å®¹é¡µé¢ã€‚</p>
                        <button @click="navigate('home')" class="mt-8 text-blue-500 hover:underline">è¿”å›é¦–é¡µ</button>
                    </div>

                </transition>
            </div>

            <!-- é¡µè„š -->
            <footer class="py-4 text-center text-xs text-slate-400 border-t border-slate-100 bg-white/50 backdrop-blur">
                &copy; 2025 æ™ºç®—è§†ç•Œ (Wisdom Computer Perspective)|
                <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener" class="py-4 text-center text-xs text-slate-400 border-t border-slate-100 bg-white/50 backdrop-blur">
                  ICPå¤‡æ¡ˆå·ï¼šæ²ªICPå¤‡2025156088å·-2
                </a>
            </footer>
        </main>
    </div>

    <!-- Vue åº”ç”¨é€»è¾‘ -->
    <script>
        const { createApp, ref, reactive, onMounted, watch, nextTick } = Vue;

        createApp({
            setup() {
                // --- çŠ¶æ€ç®¡ç† ---
                const currentPage = ref('home');
                const sidebarOpen = ref(false);
                const isMobile = ref(window.innerWidth < 1024);
                const user = ref(null); // ç”¨æˆ·å¯¹è±¡

                // å¯¼èˆªé…ç½®
                const navItems = [
                    { id: 'home', label: 'é¦–é¡µæ¦‚è§ˆ', icon: 'fa-solid fa-house' },
                    { id: 'detect', label: 'ç®—å¼è¯†åˆ«', icon: 'fa-solid fa-camera' },
                    { id: 'calculate', label: 'åŠ¨æ€è®¡ç®—', icon: 'fa-solid fa-calculator' },
                    { id: 'examples', label: 'æ•™å­¦æ¡ˆä¾‹', icon: 'fa-solid fa-film' },
                    { id: 'docs', label: 'å¸®åŠ©æ–‡æ¡£', icon: 'fa-solid fa-book' },
                ];

                // --- ç®—å¼è¯†åˆ«é€»è¾‘ ---
                const detectMode = ref('upload'); // 'upload' or 'draw'
                const uploadedImage = ref(null);
                const isProcessing = ref(false);
                const latexResult = ref("");
                const latexPreview = ref(null);
                // Canvas ç»˜å›¾ç›¸å…³
                const drawingCanvas = ref(null);
                const isEraser = ref(false);
                let ctx = null;
                let isDrawing = false;

                // --- çŸ©é˜µè®¡ç®—é€»è¾‘ ---
                const matrixASize = reactive([2, 2]);
                const matrixBSize = reactive([2, 2]);
                const matrixA = ref([[1, 2], [3, 4]]);
                const matrixB = ref([[5, 6], [7, 8]]);
                const calcResult = ref(null);
                const calcMathResult = ref(null);

                // --- ç™»å½•é€»è¾‘ ---
                const loginMode = ref('login');
                const loginForm = reactive({ username: '', password: '', captcha: '' });
                const captchaCode = ref('ABCD');

                // ---Supabase é…ç½® (è¯·æ›¿æ¢ä¸ºçœŸå® Key)---
                const supabaseUrl = 'https://fzmjkkiaibpjevtaeasl.supabase.co';
                // æ³¨æ„ï¼šåœ¨çº¯å‰ç«¯æš´éœ² Key æœ‰é£é™©ï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨åç«¯è½¬å‘
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ6bWpra2lhaWJwamV2dGFlYXNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUxMTUwMjgsImV4cCI6MjA2MDY5MTAyOH0.3ElNnjol9x6qq1_kVbgVzu6gmAz4iC-Is63yWBB-aO4';
                const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

                // --- ç”Ÿå‘½å‘¨æœŸä¸å·¥å…·å‡½æ•° ---
                onMounted(() => {
                    window.addEventListener('resize', () => {
                        isMobile.value = window.innerWidth < 1024;
                        if (!isMobile.value) sidebarOpen.value = true;
                    });
                    refreshCaptcha();
                    checkSession();
                });

                // é¡µé¢åˆ‡æ¢æ—¶çš„ Canvas åˆå§‹åŒ–
                watch(currentPage, async (newVal) => {
                    if (newVal === 'detect' && detectMode.value === 'draw') {
                        await nextTick();
                        initCanvas();
                    }
                });
                watch(detectMode, async (newVal) => {
                    if (newVal === 'draw' && currentPage.value === 'detect') {
                        await nextTick();
                        initCanvas();
                    }
                });

                // ç›‘å¬çŸ©é˜µå¤§å°å˜åŒ–åŠ¨æ€è°ƒæ•´æ•°ç»„
                watch(matrixASize, ([rows, cols]) => {
                    matrixA.value = resizeMatrix(matrixA.value, rows, cols);
                });
                watch(matrixBSize, ([rows, cols]) => {
                    matrixB.value = resizeMatrix(matrixB.value, rows, cols);
                });

                // ç›‘å¬ LaTeX ç»“æœå¹¶æ¸²æŸ“
                watch(latexResult, (newVal) => {
                    if (newVal && latexPreview.value) {
                        try {
                            katex.render(newVal, latexPreview.value, { throwOnError: false, displayMode: true });
                        } catch (e) {
                            console.error(e);
                        }
                    }
                });

                // --- æ–¹æ³•å®ç° ---

                const navigate = (page) => {
                    currentPage.value = page;
                    if (isMobile.value) sidebarOpen.value = false;
                };

                const toggleSidebar = () => {
                    sidebarOpen.value = !sidebarOpen.value;
                };

                // Canvas é€»è¾‘
                const initCanvas = () => {
                    const canvas = drawingCanvas.value;
                    if (!canvas) return;

                    // è®¾ç½®ç”»å¸ƒå®é™…å¤§å°
                    const parent = canvas.parentElement;
                    canvas.width = parent.clientWidth;
                    canvas.height = parent.clientHeight; // 500px in css

                    ctx = canvas.getContext('2d');
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    ctx.fillStyle = "#fff";
                    ctx.fillRect(0, 0, canvas.width, canvas.height); // ç™½è‰²èƒŒæ™¯

                    // äº‹ä»¶ç›‘å¬
                    const startPos = (e) => {
                        isDrawing = true;
                        ctx.beginPath();
                        const { x, y } = getPos(e);
                        ctx.moveTo(x, y);
                    };
                    const draw = (e) => {
                        if (!isDrawing) return;
                        const { x, y } = getPos(e);
                        ctx.lineWidth = isEraser.value ? 20 : 3;
                        ctx.strokeStyle = isEraser.value ? '#fff' : '#000';
                        ctx.lineTo(x, y);
                        ctx.stroke();
                    };
                    const stopPos = () => { isDrawing = false; };

                    canvas.addEventListener('mousedown', startPos);
                    canvas.addEventListener('mousemove', draw);
                    canvas.addEventListener('mouseup', stopPos);
                    canvas.addEventListener('touchstart', (e) => startPos(e.touches[0]));
                    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e.touches[0]); });
                    canvas.addEventListener('touchend', stopPos);
                };

                const getPos = (e) => {
                    const rect = drawingCanvas.value.getBoundingClientRect();
                    return {
                        x: e.clientX - rect.left,
                        y: e.clientY - rect.top
                    };
                };

                const clearCanvas = () => {
                    if(ctx) ctx.fillRect(0, 0, drawingCanvas.value.width, drawingCanvas.value.height);
                };

                // æ–‡ä»¶ä¸Šä¼ 
                const handleFileUpload = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => uploadedImage.value = e.target.result;
                        reader.readAsDataURL(file);
                    }
                };

                // æ¨¡æ‹Ÿè¯†åˆ« (å®é™…éœ€è¦è°ƒç”¨ Aliyun API)
                const processDetection = () => {
                    if (detectMode.value === 'upload' && !uploadedImage.value) return alert('è¯·å…ˆä¸Šä¼ å›¾ç‰‡');

                    isProcessing.value = true;
                    // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å»¶è¿Ÿ
                    setTimeout(() => {
                        isProcessing.value = false;
                        // è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿè¿”å›ç»“æœï¼Œå®é™…å¼€å‘ä¸­éœ€è¦ç”¨ axios å‘é€ base64 åˆ° API
                        latexResult.value = `\\begin{bmatrix} 1 & 2 \\\\ 3 & 4 \\end{bmatrix}`;
                        alert('æ³¨æ„ï¼šæ­¤ä¸ºHTMLæ¼”ç¤ºç‰ˆï¼Œæœªè¿æ¥çœŸå®åç«¯ APIã€‚å·²ç”Ÿæˆæ¨¡æ‹Ÿç»“æœã€‚');
                    }, 1500);
                };

                // çŸ©é˜µè¾…åŠ©
                const resizeMatrix = (oldMatrix, r, c) => {
                    const newMat = [];
                    for (let i = 0; i < r; i++) {
                        const row = [];
                        for (let j = 0; j < c; j++) {
                            row.push(oldMatrix[i] && oldMatrix[i][j] !== undefined ? oldMatrix[i][j] : 0);
                        }
                        newMat.push(row);
                    }
                    return newMat;
                };

                // çŸ©é˜µè®¡ç®—
                const calcMatrix = (op) => {
                    calcResult.value = true;
                    setTimeout(() => {
                        try {
                            let res;
                            let texStr = "";
                            const A = math.matrix(matrixA.value);

                            if (op === 'det') {
                                // å¿…é¡»æ˜¯æ–¹é˜µ
                                if (matrixASize[0] !== matrixASize[1]) throw new Error("è¡Œåˆ—å¼éœ€è¦æ–¹é˜µ");
                                res = math.det(A);
                                texStr = `|A| = ${math.round(res, 4)}`;
                            } else {
                                const B = math.matrix(matrixB.value);
                                if (op === 'add') {
                                    res = math.add(A, B);
                                    texStr = "A + B = " + parseMatrixToTex(res._data);
                                } else if (op === 'mul') {
                                    res = math.multiply(A, B);
                                    texStr = "A \\times B = " + parseMatrixToTex(res._data);
                                }
                            }

                            if (calcMathResult.value) {
                                katex.render(texStr, calcMathResult.value);
                            }
                        } catch (e) {
                            alert("è®¡ç®—é”™è¯¯: " + e.message);
                        }
                    }, 100);
                };

                const parseMatrixToTex = (data) => {
                    let str = "\\begin{bmatrix}";
                    data.forEach((row, i) => {
                        str += row.join(" & ");
                        if (i < data.length - 1) str += " \\\\ ";
                    });
                    str += "\\end{bmatrix}";
                    return str;
                };

                // ç™»å½•è®¤è¯
                const refreshCaptcha = () => {
                    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
                    captchaCode.value = Array(4).fill(0).map(() => chars.charAt(Math.floor(Math.random() * chars.length))).join('');
                };

                const handleAuth = async () => {
                    if (loginForm.captcha.toUpperCase() !== captchaCode.value) {
                        alert("éªŒè¯ç é”™è¯¯");
                        refreshCaptcha();
                        return;
                    }
                    if (!loginForm.username || !loginForm.password) return alert("è¯·è¾“å…¥å®Œæ•´ä¿¡æ¯");

                    // çœŸå® Supabase ç™»å½• (è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œç›´æ¥æŸ¥è¯¢)
                    try {
                        const { data, error } = await supabase
                            .from('users')
                            .select('*')
                            .eq('username', loginForm.username);

                        if (loginMode.value === 'login') {
                            // å®é™…åº”æ¯”å¯¹ Hash å¯†ç ï¼Œè¿™é‡Œä»…æ¼”ç¤º
                            if (data && data.length > 0) {
                                user.value = data[0];
                                navigate('home');
                            } else {
                                alert("ç”¨æˆ·ä¸å­˜åœ¨æˆ–å¯†ç é”™è¯¯");
                            }
                        } else {
                            // æ³¨å†Œ (æ­¤å¤„æœªåš Hashï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»åœ¨åç«¯åš)
                             const { error: insertError } = await supabase
                                .from('users')
                                .insert({ username: loginForm.username, hashed_password: loginForm.password }); // Demo only

                             if (!insertError) {
                                 alert("æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•");
                                 loginMode.value = 'login';
                             } else {
                                 alert("æ³¨å†Œå¤±è´¥: " + insertError.message);
                             }
                        }
                    } catch (e) {
                        console.error(e);
                        // Fallback Demo Login if API fails (e.g. invalid key)
                        user.value = { username: loginForm.username };
                        navigate('home');
                    }
                };

                const checkSession = () => {
                    // Check local storage or supabase session
                };

                const logout = () => {
                    user.value = null;
                };

                return {
                    currentPage, sidebarOpen, isMobile, navItems, user,
                    navigate, toggleSidebar,
                    // Detect
                    detectMode, uploadedImage, handleFileUpload, processDetection, isProcessing,
                    latexResult, latexPreview, drawingCanvas, isEraser, clearCanvas,
                    // Calc
                    matrixASize, matrixBSize, matrixA, matrixB, calcMatrix, calcResult, calcMathResult,
                    // Login
                    loginMode, loginForm, captchaCode, refreshCaptcha, handleAuth, logout,
                    videoPlaying: ref(false)
                };
            }
        }).mount('#app');
    </script>
</body>
</html>